<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Foreground Color Finder</title>
    <link rel="stylesheet" href="normalize.css" />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <noscript>
      <dialog open>
        <h1>⚠️ JavaScript Required ⚠️</h1>
        <p>
          To use this service, JavaScript must be enabled in your browser. This
          is necessary to perform the calculations that power the functionality
          of the site. Rest assured, everything runs entirely on your local
          device. We do not collect any data, store cookies, or connect to any
          external servers. Your privacy and security are fully maintained, as
          no information is ever transmitted or stored.
        </p>
      </dialog>
    </noscript>

    <nav></nav>
    <header>
      <h1>Foreground Color Finder</h1>
    </header>
    <main>
      <form>
        <fieldset>
          <legend>Background Color (𝐲)</legend>
          <!--<input type="color" id="bgColor" value="#f2efec" /><br />-->
          <input
            type="number"
            min="0"
            max="255"
            step="1"
            tabindex="1"
            value="242"
            id="backR"
          />
          <input
            type="number"
            min="0"
            max="255"
            step="1"
            tabindex="2"
            value="239"
            id="backG"
          />
          <input
            type="number"
            min="0"
            max="255"
            step="1"
            tabindex="3"
            value="236"
            id="backB"
          />
        </fieldset>

        <fieldset>
          <legend>Seen Color (𝐳)</legend>
          <!--<input type="color" id="observedColor" value="#d0eff3" /><br />-->
          <input
            type="number"
            min="0"
            max="255"
            step="1"
            tabindex="4"
            value="208"
            id="seenR"
          />
          <input
            type="number"
            min="0"
            max="255"
            step="1"
            tabindex="5"
            value="239"
            id="seenG"
          />
          <input
            type="number"
            min="0"
            max="255"
            step="1"
            tabindex="6"
            value="243"
            id="seenB"
          />
        </fieldset>

        <input type="button" value="Calc 𝐱" id="calcBtn" tabindex="7" />

        <div style="display: flex; align-items: center; gap: 10px">
          <div>𝐱</div>
          <div>=</div>
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 5px;
            "
          >
            <span style="padding-inline: 20px"> 𝐳 - 𝐲(𝟏 - 𝜶) </span>

            <span style="width: 100%; border: 1px solid black"></span>

            <span style="width: 100%; text-align: center">𝜶</span>
          </div>
        </div>
      </form>
      <aside>
        <div class="simulation">
          <div class="background"></div>
          <div class="foreground"></div>
          <div class="intersection"></div>
        </div>
      </aside>
    </main>

    <h2>Possible Foreground Colors (X)</h2>
    <table>
      <thead>
        <tr>
          <th>𝐱</th>
          <th>𝐱 Details</th>
          <th>𝐱 over 𝐲</th>
          <th>𝐳</th>
        </tr>
      </thead>
      <tbody id="results"></tbody>
    </table>

    <footer></footer>
  </body>

  <script>
    function hexToRgb(hex) {
      hex = hex.replace(/^#/, "");
      let bigint = parseInt(hex, 16);
      let r = (bigint >> 16) & 255;
      let g = (bigint >> 8) & 255;
      let b = bigint & 255;
      return [r, g, b];
    }

    function rgbToHex(r, g, b) {
      return (
        "#" +
        ((1 << 24) + (r << 16) + (g << 8) + b)
          .toString(16)
          .slice(1)
          .toUpperCase()
      );
    }

    function rgbaToHex(r, g, b, a) {
      const alpha = Math.round(a * 255)
        .toString(16)
        .padStart(2, "0")
        .toUpperCase();
      return `${rgbToHex(r, g, b)}${alpha}`;
    }

    function calculateForegroundColor(seen, back, opacity) {
      let fore = {
        r: 0,
        g: 0,
        b: 0,
      };

      fore.r = Math.round((seen.r - (1 - opacity) * back.r) / opacity);
      fore.g = Math.round((seen.g - (1 - opacity) * seen.g) / opacity);
      fore.b = Math.round((seen.b - (1 - opacity) * seen.b) / opacity);

      fore.r = Math.min(255, Math.max(0, fore.r));
      fore.g = Math.min(255, Math.max(0, fore.g));
      fore.b = Math.min(255, Math.max(0, fore.b));

      return fore;
    }

    function createTableRow(
      foreGround,
      seenColor,
      backGround,
      opacity,
      tabindex
    ) {
      const row = document.createElement("tr");

      // Colonna 1
      const infoCell = document.createElement("th");
      infoCell.tabIndex = tabindex;
      infoCell.style.verticalAlign = "top";
      infoCell.style.padding = "10px";
      infoCell.style.textAlign = "left";

      const alpha = opacity.toFixed(2);
      const hexWithAlpha = rgbaToHex(
        foreGround.r,
        foreGround.g,
        foreGround.b,
        opacity
      );

      // Column 2
      const whiteBgCell = document.createElement("td");
      whiteBgCell.style.backgroundColor = "#ffffff"; // Sfondo bianco
      whiteBgCell.style.position = "relative";
      whiteBgCell.style.width = "100px";
      whiteBgCell.style.height = "50px";

      const overlayWhite = document.createElement("div");
      overlayWhite.style.position = "absolute";
      overlayWhite.style.top = 0;
      overlayWhite.style.left = 0;
      overlayWhite.style.width = "100%";
      overlayWhite.style.height = "100%";
      overlayWhite.style.backgroundColor = `rgba(${foreGround.r}, ${foreGround.g}, ${foreGround.b}, ${opacity})`;

      whiteBgCell.appendChild(overlayWhite);
      row.appendChild(whiteBgCell);

      // Colonna 3
      const opacityText = document.createElement("div");
      opacityText.textContent = `Opacity: ${Math.round(opacity * 100)}%`;

      const hexText = document.createElement("div");
      hexText.textContent = `HEX: ${hexWithAlpha}`;

      const rgbText = document.createElement("div");
      rgbText.textContent = `RGB: rgba(${foreGround.r}, ${foreGround.g}, ${foreGround.b}, ${alpha})`;

      infoCell.appendChild(opacityText);
      infoCell.appendChild(hexText);
      infoCell.appendChild(rgbText);
      row.appendChild(infoCell);

      // Colonna 4
      const overlayCell = document.createElement("td");
      overlayCell.style.position = "relative";
      overlayCell.style.width = "100px";
      overlayCell.style.height = "50px";
      overlayCell.style.backgroundColor = `rgb(${backGround.r}, ${backGround.g}, ${backGround.b})`;

      const overlay = document.createElement("div");
      overlay.style.position = "absolute";
      overlay.style.top = 0;
      overlay.style.left = 0;
      overlay.style.width = "100%";
      overlay.style.height = "100%";
      overlay.style.backgroundColor = `rgba(${foreGround.r}, ${foreGround.g}, ${foreGround.b}, ${opacity})`;

      overlayCell.appendChild(overlay);
      row.appendChild(overlayCell);

      // Colonna 4: Colore osservato Z
      const seenColorCell = document.createElement("td");
      seenColorCell.style.backgroundColor = `rgb(${seenColor.r}, ${seenColor.g}, ${seenColor.b})`;
      seenColorCell.style.width = "100px";
      seenColorCell.style.height = "50px";
      seenColorCell.style.textAlign = "center";
      row.appendChild(seenColorCell);

      return row;
    }

    document.getElementById("calcBtn").addEventListener("click", function () {
      const backGround = {
        r: document.getElementById("backR").value,
        g: document.getElementById("backG").value,
        b: document.getElementById("backB").value,
      };
      const seenColor = {
        r: document.getElementById("seenR").value,
        g: document.getElementById("seenG").value,
        b: document.getElementById("seenB").value,
      };

      const table = document.getElementById("results");

      table.innerHTML = "";

      for (let i = 10; i <= 90; i += 5) {
        const opacity = i / 100;
        const foreGround = calculateForegroundColor(
          seenColor,
          backGround,
          opacity
        );

        const row = createTableRow(
          foreGround,
          seenColor,
          backGround,
          opacity,
          8 + i
        );
        table.appendChild(row);
      }
    });
  </script>
</html>
